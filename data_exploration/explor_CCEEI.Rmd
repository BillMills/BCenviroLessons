---
title: "Exploring Grizzly Data"
author: ""
date: "June 5, 2015"
output:
  html_document:
    keep_md: true
---

```{r message=FALSE}
library(tidyr)
library(dplyr)
library(knitr)
library(sp)
library(rgdal)

options(knitr.table.format = "markdown")
```


### Grizzly Bear Population Units

First, you will need to get the data. Unfortunately, unlike the `.csv` files 
that we were able to read/download directly from DataBC. Visit the [metadata record](http://catalogue.data.gov.bc.ca/dataset/grizzly-bear-population-units/resource/7a7713f9-bcbd-46b8-968a-03d343d367fb) for the data at DataBC. Click on the 
**Go To Resource** button and submit the form with the following settings:

![](img/Griz_form.png)

When you get the email with the link to the zip file, save it in your working directory as `data/DataBC_GBPU.zip`

Unzip the file, and import the shapefile. You will need the `sp` and `rgdal` packages

```{r messate = FALSE}
unzip("data/DataBC_GBPU.zip", exdir = "data")

gbpu <- readOGR(dsn = "data/GBPU_BC/", layer = "GBPU_BC_polygon", 
                encoding = "ESRI Shapefile")
```


```{r}
## getting the data
mortality <- read.csv("http://www.env.gov.bc.ca/soe/archive/data/plants-and-animals/2012_Grizzly_Status/Grizzly_bear_mortality_history.csv")

population <- read.csv("http://www.env.gov.bc.ca/soe/archive/data/plants-and-animals/2012_Grizzly_Status/Grizzly_population_estimate_2012.csv")


```


Now that we have the data, let's look at the top of it. 

```{r results='asis'}
kable(head(mortality))
```

We're going to use packages to organize and clean our data.

```{r results='asis'}


## let's get rid of unused columns
mortality <- mortality %>% 
  select(-contains("X."))


clean_mort <- mortality %>%
  separate(AGE_CLASS, into = c("minimum_age", "maximum_age"), sep = "-", extra = "merge") %>% 
  mutate(minimum_age = extract_numeric(minimum_age),
         maximum_age = extract_numeric(maximum_age))

kable(head(clean_mort))
```




## All columns should have the same data type




### Let's explore the gbpu spatial object. 

It is of class `SpatialPolygonsDataFrame`, which is a special class of **R** object for representing spatial data, implemented in the `sp` package.

```{r}
class(gbpu)
summary(gbpu)
```

From the metadata page, we know that there are several versions of the population units in this file. From the summary above it looks like the version is stored in the `GBPU_VERS`. Let's only use the latest version (2012). Note that we can 

```{r}
gbpu <- gbpu[gbpu$GBPU_VERS == 2012, ]
```

